---
title: "mapping boston crime data"
output: html_notebook
author: "jessica kant"
---

This is old code, but given the recent news, I thought I would dust it off. First a quick explainer:

mapIt() and makeMap() are simple R functions written using the tidyverse that view distribution of crime data as reported by the Boston Police Department using the data published to Analyze Boston. Given the recent reports that 


```{r}
library(tidyverse)

# files 
        
newest_data<-"~/../../Downloads/tmpa5mvyouu.csv"
code_list<-readxl::read_xlsx("~/../../Downloads/rmsoffensecodes.xlsx")
attribution<-"github.com/jessicakay"
bos_crime<-read.csv(newest_data)

# spatial landmarks
# corner of mass ave and albany, 42.333496, -71.0755771

MaAlb_long<-as.numeric("-71.0755771")
MaAlb_lat<-as.numeric("42.333496")
geo_zoom<-c(MaAlb_lat,MaAlb_long)

#

```

This was built into a simple function

```{r}

# function to retrieve, stratify and visualize by given code
# with optional argument to save as PNG file

mapIt<-function(offCode,s){
  code_list<<-as.data.frame(code_list)
  code_name<-code_list$NAME[which(code_list$CODE==offCode)]
  code_indx<-paste("code: ",code_list$CODE[which(code_list$CODE==offCode)],
                   ", name: \"",code_name,"\"", sep="")
  target<-subset(bos_crime,bos_crime$OFFENSE_CODE %in% offCode)
  years<-as.data.frame(table(target$DISTRICT))
  long_incl<-subset(target,target$Lat>"-71")
  makeMap<<-function(){
    ggplot(long_incl,aes(Long,Lat,color=YEAR))+geom_point(alpha=0.1)+
      labs(title = "Crime in Boston", 
           subtitle=tolower(code_indx),
           caption=attribution)+
        geom_hline(yintercept = geo_zoom[1],colour="grey")+
        geom_vline(xintercept = geo_zoom[2],colour="grey")
    
}
  makeMap()
  if(s==1){
      filename<-paste("~/../Documents/Github/crimeviz/plots/",
                      offCode,".png",sep="")
      png(filename=filename, width= 800, height=500)
           print({makeMap()})
      dev.off()
    }
  }

```


```{r}

# generates spacial plot of crimes designated by specific code
# and uses lookup index to retrieve name. Includes optional 
# argument to save to file where 0 = don't save,1 = save

mapIt(801,0) # 801 corresponds to "simple assault"
makeMap()

```

```{r}

( bos_crime %>% filter(YEAR=="2016") -> bos_crime )

```
 
 Often the same charge has multiple codes, even within the same dataset. Here is what happen when you use mos
 
```{r}

mapIt(801,0)
makeMap()
mapIt(802,0)
makeMap()
mapIt(c(801,802),0)
makeMap()


```
 
 